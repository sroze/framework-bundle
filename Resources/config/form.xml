<?xml version="1.0" ?>

<container xmlns="http://www.symfony-project.org/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.symfony-project.org/schema/dic/services http://www.symfony-project.org/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="form.factory.class">Symfony\Component\Form\FormFactory</parameter>
        <parameter key="form.config.loader.class">Symfony\Bundle\FrameworkBundle\Form\ContainerAwareConfigLoader</parameter>
        <parameter key="form.guesser.validator.class">Symfony\Component\Form\Guesser\ValidatorFieldGuesser</parameter>
        <parameter key="form.csrf_provider.class">Symfony\Component\Form\CsrfProvider\SessionCsrfProvider</parameter>
        <parameter key="form.theme.class">Symfony\Component\Form\Renderer\Theme\TwigTheme</parameter>
        <parameter key="form.theme.template">TwigBundle::div_layout.html.twig</parameter>
        <parameter key="form.factory.class">Symfony\Component\Form\FormFactory</parameter>
        <parameter key="form.csrf_protection.enabled">true</parameter>
        <parameter key="form.csrf_protection.field_name">_token</parameter>
        <parameter key="form.csrf_protection.secret">secret</parameter>
        <parameter key="form.validation_groups">Default</parameter>
        <parameter key="file.temporary_storage.class">Symfony\Component\HttpFoundation\File\SessionBasedTemporaryStorage</parameter>
        <!-- TODO: configure through Configuration! -->
        <parameter key="file.temporary_storage.secret">abcdef</parameter>
        <parameter key="file.temporary_storage.nesting_levels">3</parameter>
        <parameter key="file.temporary_storage.directory"></parameter>
    </parameters>

    <services>

        <!-- FormFactory -->
        <service id="form.factory" class="%form.factory.class%">
            <argument type="service" id="form.config.loader" />
        </service>

        <!-- ValidatorFieldGuesser -->
        <service id="form.guesser.validator" class="%form.guesser.validator.class%" public="false">
            <tag name="form.guesser" />
            <argument type="service" id="validator.mapping.class_metadata_factory" />
        </service>
        
        <!-- CsrfProvider -->
        <service id="form.csrf_provider" class="%form.csrf_provider.class%">
            <argument type="service" id="session" />
            <argument>%form.csrf_protection.secret%</argument>
        </service>
        
        <!-- Theme -->
        <service id="form.theme" class="%form.theme.class%">
            <argument type="service" id="twig" />
            <argument>%form.theme.template%</argument>
        </service>
        
        <!-- TemporaryStorage - where should we put this? -->
        <service id="file.temporary_storage" class="%file.temporary_storage.class%">
            <argument type="service" id="session" />
            <argument>%file.temporary_storage.secret%</argument>
            <argument>%file.temporary_storage.nesting_levels%</argument>
            <argument>%file.temporary_storage.directory%</argument>
        </service>
        
        <!-- ContainerAwareConfigLoader -->
        <service id="form.config.loader" class="%form.config.loader.class%">
            <argument type="service" id="service_container" />
            <!--
            All services with tag "form.config" are inserted here by 
            AddFormConfigsPass
            -->
            <argument type="collection" />
        </service>

        <!-- FieldConfigs -->
        <service id="form.config.field" class="Symfony\Component\Form\Config\FieldConfig">
            <tag name="form.config" alias="field" />
            <argument type="service" id="form.factory" />
            <argument type="service" id="form.theme" />
        </service>
        <service id="form.config.form" class="Symfony\Component\Form\Config\FormConfig">
            <tag name="form.config" alias="form" />
            <argument type="service" id="form.factory" />
            <argument type="service" id="form.csrf_provider" />
            <argument type="service" id="validator" />
        </service>
        <service id="form.config.birthday" class="Symfony\Component\Form\Config\BirthdayFieldConfig">
            <tag name="form.config" alias="birthday" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.checkbox" class="Symfony\Component\Form\Config\CheckboxFieldConfig">
            <tag name="form.config" alias="checkbox" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.choice" class="Symfony\Component\Form\Config\ChoiceFieldConfig">
            <tag name="form.config" alias="choice" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.collection" class="Symfony\Component\Form\Config\CollectionFieldConfig">
            <tag name="form.config" alias="collection" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.country" class="Symfony\Component\Form\Config\CountryFieldConfig">
            <tag name="form.config" alias="country" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.date" class="Symfony\Component\Form\Config\DateFieldConfig">
            <tag name="form.config" alias="date" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.datetime" class="Symfony\Component\Form\Config\DateTimeFieldConfig">
            <tag name="form.config" alias="datetime" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.entity" class="Symfony\Component\Form\Config\EntityFieldConfig">
            <tag name="form.config" alias="entity" />
            <argument type="service" id="form.factory" />
            <argument type="service" id="doctrine.orm.default_entity_manager" />
        </service>
        <service id="form.config.file" class="Symfony\Component\Form\Config\FileFieldConfig">
            <tag name="form.config" alias="file" />
            <argument type="service" id="form.factory" />
            <argument type="service" id="file.temporary_storage" />
        </service>
        <service id="form.config.hidden" class="Symfony\Component\Form\Config\HiddenFieldConfig">
            <tag name="form.config" alias="hidden" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.integer" class="Symfony\Component\Form\Config\IntegerFieldConfig">
            <tag name="form.config" alias="integer" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.language" class="Symfony\Component\Form\Config\LanguageFieldConfig">
            <tag name="form.config" alias="language" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.locale" class="Symfony\Component\Form\Config\LocaleFieldConfig">
            <tag name="form.config" alias="locale" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.money" class="Symfony\Component\Form\Config\MoneyFieldConfig">
            <tag name="form.config" alias="money" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.number" class="Symfony\Component\Form\Config\NumberFieldConfig">
            <tag name="form.config" alias="number" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.password" class="Symfony\Component\Form\Config\PasswordFieldConfig">
            <tag name="form.config" alias="password" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.percent" class="Symfony\Component\Form\Config\PercentFieldConfig">
            <tag name="form.config" alias="percent" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.radio" class="Symfony\Component\Form\Config\RadioFieldConfig">
            <tag name="form.config" alias="radio" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.repeated" class="Symfony\Component\Form\Config\RepeatedFieldConfig">
            <tag name="form.config" alias="repeated" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.textarea" class="Symfony\Component\Form\Config\TextareaFieldConfig">
            <tag name="form.config" alias="textarea" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.text" class="Symfony\Component\Form\Config\TextFieldConfig">
            <tag name="form.config" alias="text" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.time" class="Symfony\Component\Form\Config\TimeFieldConfig">
            <tag name="form.config" alias="time" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.timezone" class="Symfony\Component\Form\Config\TimezoneFieldConfig">
            <tag name="form.config" alias="timezone" />
            <argument type="service" id="form.factory" />
        </service>
        <service id="form.config.url" class="Symfony\Component\Form\Config\UrlFieldConfig">
            <tag name="form.config" alias="url" />
            <argument type="service" id="form.factory" />
        </service>
        
    </services>
</container>
